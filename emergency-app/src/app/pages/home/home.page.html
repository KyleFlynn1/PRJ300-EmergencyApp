<ion-header [translucent]="true">
  <ion-toolbar class="section-header">
    <ion-title>Alerts</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <!--Current Status section -->
  <div class="section">
    <h2>Current Status</h2>
    <div *ngIf="activeAlertsInArea.length === 0" class="status-card status-success">
      <ion-icon name="checkmark-circle" class="status-icon"></ion-icon>
      <div class="status-content">
        <h3>All Clear</h3>
        <p>No active emergencies in your area</p>
      </div>
    </div>

    <div *ngIf="activeAlertsInArea.length > 0" class="status-card status-danger">
      <ion-icon name="warning" class="status-icon"></ion-icon>
      <div class="status-content">
        <h3>Active Alert</h3>
        <p>{{ activeAlertsInArea.length }} emergency alert(s) in your area</p>
      </div>
    </div>
  </div>

  <!--Feed section -->
  <div class="section">
    <h2>Your Feed</h2>

    <div class="feed-list">
      <!-- No alerts message -->
      <div *ngIf="activeAlertsInArea.length === 0" class="no-alerts-message">
        <ion-icon name="information-circle-outline"></ion-icon>
        <span>No alerts in your area</span>
      </div>

      <!-- Auto add new alerts from report modal and alert service-->
      <div
         *ngFor="let alert of activeAlertsInArea"
         class="native-feed-card feed-card" (click)="openAlertDetailModal(alert)" [style.background]="getAlertSeverityColor(alert.severity)">
        <div class="card-iinner"> 
          <ion-icon [name]="getIcon(alert.category)" class="card-icon"></ion-icon>
          <div class="card-content">
            <div class="card-header">
              <h3>{{ alert.category }}</h3>
              <span class="severity-badge">{{ alert.severity }}</span>
            </div>
            <p>{{ alert.notes }}</p>
            <small>{{ getDistanceString(alert) }} • {{ getFormattedTimestamp(alert.timestamp) }}</small>
          </div>
        </div>
      </div>

      <!-- Static test cards -->
       <!-- 
      <div class="native-feed-card" (click)="openAlertDetailModal()" style="background: #3ead44">
        <div class="card-iinner"> 
          <ion-icon name="leaf" class="card-icon"></ion-icon>
          <div class="card-content">
            <div class="card-header">
              <h3>Tree Down</h3>
              <span class="severity-badge">Low</span>
            </div>
            <p>Minor blockage on Main St - Services Alerted</p>
            <small>Main St • 12m ago</small>
          </div>
        </div>
      </div>

      <div class="native-feed-card" (click)="openAlertDetailModal()" style="background: #ff8e1d">
        <div class="card-iinner"> 
          <ion-icon name="thunderstorm" class="card-icon"></ion-icon>
          <div class="card-content">
            <div class="card-header">
              <h3>Storm Watch</h3>
              <span class="severity-badge">Moderate</span>
            </div>
            <p>Severe storms expected this evening</p>
            <small>County-wide • 30m ago</small>
          </div>
        </div>
      </div>

      <div class="native-feed-card" (click)="openAlertDetailModal()" style="background: #ec0303">
        <div class="card-iinner"> 
          <ion-icon name="water" class="card-icon"></ion-icon>
          <div class="card-content">
            <div class="card-header">
              <h3>Flooded Road</h3>
              <span class="severity-badge">High</span>
            </div>
            <p>Severe flooding on Canal Street — road closed</p>
            <small>Canal St • 1h ago</small>
          </div>
        </div>
      </div>

      <div class="native-feed-card" (click)="openAlertDetailModal()" style="background: #797979">
        <div class="card-iinner"> 
          <ion-icon name="flash" class="card-icon"></ion-icon>
          <div class="card-content">
            <div class="card-header">
              <h3>Power Outage</h3>
              <span class="severity-badge">Info</span>
            </div>
            <p>Power Outage reported at Main St</p>
            <small>1:20 PM • 3h ago</small>
          </div>
        </div>
      </div>
      -->

    </div>

    <!-- View All Alerts Button -->
    <div style="text-align: center; margin-top: 16px;">
      <button class="view-all-alerts-button" routerLink="/alerts">
        View All Alerts
        <ion-icon name="chevron-forward"></ion-icon>
      </button>
    </div>
  </div>

  <!-- Report Section -->
  <div class="section action-buttons-section">
    <div class="report-container">
      <button class="native-report-button" color="danger" size="large" shape="round" fill="solid" (click)="openReportModal()">
        <ion-icon name="paper-plane"></ion-icon>
        Report Emergency
      </button>
      <p class="report-note">
        Tap to report an incident — responders will be notified
      </p>
    </div>

    <!-- Defibrillator Map Button -->
    <div class="report-container defib-container">
      <button class="native-defib-button" routerLink="/defibilators">
        <ion-icon name="heart-outline"></ion-icon>
        Defibrillator Map
      </button>
      <p class="report-note">
        Find nearby defibrillators in your area
      </p>
    </div>
  </div>

  <!--Other warnings section -->
  <div class="section other-warnings">
    <h2>Other Warnings / Info</h2>

    <div class="warning-list">
      <div class="native-warning-card" style="background: #f200ff">
        <div>
          <ion-icon name="alert-circle"></ion-icon>
          <div>
            <h3>Amber Alert</h3>
            <p>Missing child reported — check local updates for more details</p>
          </div>
        </div>
      </div>

      <div class="native-warning-card" style="background: #ff8e1d">
        <div>
          <ion-icon name="megaphone"></ion-icon>
          <div>
            <h3>Community Notice</h3>
            <p>Roadworks between Main Road and Side Road 7PM-7AM</p>
          </div>
        </div>
      </div>

    </div>
  </div>
</ion-content>

<!-- Report Modal -->
<div class="native-modal-overlay" *ngIf="showReportModal">
  <div class="native-modal-content">
    <div class="modal-header">
      <h2>Report Emergency</h2>
      <button class="close-button" (click)="closeReportModal()">
        <ion-icon name="close"></ion-icon>
      </button>
    </div>
    <div class="modal-body">
      <app-report-modal [isNativeModal]="true" (closeModal)="handleReportClose($event)"></app-report-modal>
    </div>
  </div>
</div>

<!-- Alert Detail Modal -->
<div class="native-modal-overlay" *ngIf="showAlertDetailModal">
  <div class="native-modal-content" [style.background]="getAlertSeverityColor(selectedAlert?.severity)">
    <div class="modal-header">
      <h2>{{selectedAlert?.category || 'Alert Details'}}</h2>
      <button class="close-button" (click)="closeAlertDetailModal()">
        <ion-icon name="close"></ion-icon>
      </button>
    </div>
    <div class="modal-body">
      <app-alert-detail-modal [alert]="selectedAlert" [isNativeModal]="true"></app-alert-detail-modal>
    </div>
  </div>
</div>