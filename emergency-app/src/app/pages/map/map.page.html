<ion-header [translucent]="false" class="app-header">
  <div class="header-spacer"></div>
  <div class="header-row">
    <h1>Map</h1>
  </div>
</ion-header>
<ion-content [fullscreen]="true" [scrollY]="false">

  <div class="section action-buttons-section">
    <div class="report-container">
      <button
        class="native-report-button"
        color="danger"
        size="large"
        shape="round"
        fill="solid"
        (click)="openReportModal()"
      >
        <ion-icon name="paper-plane"></ion-icon>
        Report Emergency
      </button>
      <p class="report-note">
        Tap to report an incident â€” responders will be notified
      </p>
    </div>
  </div>
  <!--Filter Buttons-->
  <div class="filter-card">  
    <div
      class="filter-buttons"
      style="display: flex; justify-content: center; gap: 8px; margin: 12px 0"
    >
      <button
        class="filter-button filter-all"
        [class.selected]="selectedSeverityFilter === 'all'"
        (click)="setSeverityFilter('all')"
      >
        <ion-icon name="alert-circle-outline"></ion-icon>
      </button>
      <button
        class="filter-button filter-info"
        [class.selected]="selectedSeverityFilter === 'info'"
        (click)="setSeverityFilter('info')"
      >
        <ion-icon name="information-circle-outline"></ion-icon>
      </button>
      <button
        class="filter-button filter-low"
        [class.selected]="selectedSeverityFilter === 'low'"
        (click)="setSeverityFilter('low')"
      >
        <ion-icon name="checkmark-circle-outline"></ion-icon>
      </button>
      <button
        class="filter-button filter-moderate"
        [class.selected]="selectedSeverityFilter === 'moderate'"
        (click)="setSeverityFilter('moderate')"
      >
        <ion-icon name="alert-circle-outline"></ion-icon>
      </button>
      <button
        class="filter-button filter-high"
        [class.selected]="selectedSeverityFilter === 'high'"
        (click)="setSeverityFilter('high')"
      >
        <ion-icon name="warning-outline"></ion-icon>
      </button>
      <button
        class="filter-button filter-urgent"
        [class.selected]="selectedSeverityFilter === 'urgent'"
        (click)="setSeverityFilter('urgent')"
      >
        <ion-icon name="alarm-outline"></ion-icon>
      </button>
    </div>
    <div class="filter-row-combined">
      <select [(ngModel)]="selectedType" (change)="filterAlerts()" class="styled-type-select">
        <option value="all">All</option>
        <option value="other">Other</option>
        <option value="missing-person">Missing Person</option>
        <option value="injury">Injury</option>
        <option value="tree-fallen">Tree fallen</option>
        <option value="power-outage">Power outage</option>
        <option value="fire">Fire</option>
        <option value="flood">Flood</option>
        <option value="road-blockage">Road blockage</option>
        <option value="weather">Weather</option>
      </select>
      <div class="status-segment minimalist-status styled-status-segment">
        <label class="styled-radio-label">
          <input type="radio" name="status" value="all" [(ngModel)]="selectedStatus" (change)="filterAlerts()">
          <span>All</span>
        </label>
        <label class="styled-radio-label">
          <input type="radio" name="status" value="active" [(ngModel)]="selectedStatus" (change)="filterAlerts()">
          <span>Active</span>
        </label>
        <label class="styled-radio-label">
          <input type="radio" name="status" value="inactive" [(ngModel)]="selectedStatus" (change)="filterAlerts()">
          <span>Inactive</span>
        </label>
      </div>
    </div>
  </div>
  <app-map-component
    [pins]="pins"
    (alertSelected)="openAlertDetailModal($event)"
    (reportLocation)="openReportModalWithLocation($event.lat, $event.lng, $event.address)"
  >
  </app-map-component>
</ion-content>
<div class="native-modal-overlay" *ngIf="showReportModal">
  <div class="native-modal-content">
    <div class="modal-header">
      <h2>Report Emergency</h2>
      <button class="close-button" (click)="closeReportModal()">
        <ion-icon name="close"></ion-icon>
      </button>
    </div>
    <div class="modal-body">
      <app-report-modal
        [isNativeModal]="true"
        (closeModal)="handleReportClose($event)"
        [alert]="reportModalLocation ? { severity: 'Info', category: 'Other', timestamp: currentTimestamp, location: reportModalLocation } : undefined"
      ></app-report-modal>
    </div>
  </div>
</div>

<!-- Alert Detail Modal -->
<div class="native-modal-overlay" *ngIf="showAlertDetailModal">
  <div
    class="native-modal-content"
    [style.border-left]="'6px solid ' + getAlertSeverityColor(selectedAlert?.severity)"
  >
    <div class="modal-header">
      <h2>{{selectedAlert?.category || 'Alert Details'}}</h2>
      <button class="close-button" (click)="closeAlertDetailModal()">
        <ion-icon name="close"></ion-icon>
      </button>
    </div>
    <div class="modal-body">
      <app-alert-detail-modal
        [alert]="selectedAlert"
        [isNativeModal]="true"
      ></app-alert-detail-modal>
    </div>
  </div>
</div>
